<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rusty Degen | Rust Jackpot</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Titillium+Web:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <meta name="description" content="Rusty Degen - A secure, fair, and exciting Rust skin jackpot platform with provable fairness and transparent gameplay.">
    <meta name="theme-color" content="#00e676">
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' /socket.io/socket.io.js; style-src 'self' https://fonts.googleapis.com https://cdnjs.cloudflare.com; img-src 'self' data: *.steamstatic.com *.akamai.steamstatic.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self' wss: ws: https://rust.scmm.app; frame-src 'self' https://steamcommunity.com">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="Referrer-Policy" content="same-origin">
</head>
<body>

    <div id="notification-bar" class="notification-bar"></div>

    <div class="modal age-verification" id="ageVerificationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Age Verification</h2>
            </div>
            <div class="modal-body">
                <p>You must be at least 18 years old to use this site.</p>
                <p>By clicking "Agree" you confirm that:</p>
                <ul>
                    <li>You are at least 18 years old</li>
                    <li>You are legally allowed to trade skins from your country</li>
                    <li>You understand and accept the risks associated with skin gambling</li>
                    <li>You have read and agree to our <a href="#" id="tos-link-modal" target="_blank">Terms of Service</a></li>
                </ul>
                <div class="checkbox-container">
                    <input type="checkbox" id="agreeCheckbox">
                    <label for="agreeCheckbox">I confirm I meet all requirements and agree to the Terms of Service.</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="agreeButton">Agree & Enter</button>
            </div>
        </div>
    </div>

    <div class="modal deposit-modal" id="depositModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Deposit Items</h2>
                <button class="close-btn" id="closeDepositModal" aria-label="Close deposit modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="inventory-loading" class="loading-indicator" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading your inventory...</p>
                </div>
                <div class="inventory-container">
                    <h3>Your Inventory (Select items to deposit)</h3>
                    <div class="inventory-items" id="inventory-items">
                    </div>
                </div>
                <div class="selected-items">
                    <h3>Selected Items</h3>
                    <div class="selected-items-container" id="selectedItems">
                    </div>
                    <div class="total-value">
                        <span>Total Value: </span>
                        <span id="totalValue">$0.00</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <span id="depositStatusText" class="deposit-status-text" style="flex-grow: 1; text-align: left; color: var(--text-secondary); font-size: 0.9em;"></span>
                <button class="btn btn-primary" id="depositButton" disabled>Request Deposit Offer</button>
                <button class="btn btn-success" id="acceptDepositOfferBtn" style="display: none;" title="Opens the Steam trade offer in a new tab">
                    Accept on Steam <i class="fas fa-external-link-alt"></i>
                </button>
            </div>
        </div>
    </div>
   <div class="modal" id="tradeHistoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Trade History</h2>
                <button class="close-btn" id="closeTradeHistoryModal" aria-label="Close trade history modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="trade-history-container">
                    <div id="tradeHistoryLoading" class="loading-indicator" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading your trade history...</p>
                    </div>
                    <div id="emptyTradeHistory" class="empty-history-message" style="display: none;">
                        <p>You don't have any trade history yet.</p>
                    </div>
                    <table id="tradeHistoryTable" class="history-table trade-history-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Round</th>
                                <th>Type</th>
                                <th>Items</th>
                                <th>Value</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="tradeHistoryTableBody">
                        </tbody>
                    </table>
                </div>
                
                <!-- Pending Trades Section -->
                <div id="pendingTradesSection" class="pending-trades-section" style="display: none; margin-top: 20px;">
                    <h3 class="section-title">Pending Winning Offers</h3>
                    <div class="pending-trades-container">
                        <div id="pendingTradesList" class="pending-trades-list">
                            <!-- Pending trades will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeTradeHistoryBtn">Close</button>
            </div>
        </div>
    </div>

    <div class="modal" id="tradeUrlModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Set Your Trade URL</h2>
                <button class="close-btn" id="closeTradeUrlModal" aria-label="Close trade URL modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Please enter your Steam Trade URL to complete deposits and receive winnings:</p>
                <div class="form-group">
                    <label for="modalTradeUrlInput">Steam Trade URL</label>
                    <input type="url" id="modalTradeUrlInput" placeholder="https://steamcommunity.com/tradeoffer/new/?partner=...">
                </div>
                <p class="help-text">
                    You can find your trade URL in your
                    <a href="https://steamcommunity.com/my/tradeoffers/privacy" target="_blank" rel="noopener noreferrer">Steam Trade Privacy Settings</a>.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="saveTradeUrl">Save Trade URL</button>
            </div>
        </div>
    </div>

    <div class="modal profile-modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Your Profile</h2>
                <button class="close-btn" id="profileModalCloseBtn" aria-label="Close profile modal">&times;</button>
            </div>
            <div class="modal-body profile-modal-body">
                <div class="profile-modal-user-info">
                    <img src="/img/default-avatar.png" alt="User Avatar" class="profile-modal-avatar" id="profileModalAvatar">
                    <span class="profile-modal-name" id="profileModalName">PlayerName</span>
                </div>

                <div id="profile-pending-offer-status" class="profile-pending-offer-status" style="display: none; margin-bottom: 15px; padding: 10px; background-color: var(--background-light); border: 1px solid var(--secondary-dark); border-radius: 4px; text-align: center;">
                </div>

                <div class="profile-modal-stats">
                    <div class="profile-stat-row">
                        <div class="profile-stat-col">
                            <span class="profile-modal-stat-label">Total Deposited:</span>
                            <span class="profile-modal-stat-value" id="profileModalDeposited">$0.00</span>
                        </div>
                        <div class="profile-stat-col">
                            <span class="profile-modal-stat-label">Total Won:</span>
                            <span class="profile-modal-stat-value" id="profileModalWon">$0.00</span>
                        </div>
                    </div>
                </div>

                <div class="form-group profile-modal-trade-url">
                    <label for="profileModalTradeUrl">Steam Trade URL</label>
                    <input type="url" id="profileModalTradeUrl" placeholder="https://steamcommunity.com/tradeoffer/new/?partner=...">
                    <p class="help-text profile-modal-help-text">
                        Required for deposits and withdrawals.
                        <a href="https://steamcommunity.com/my/tradeoffers/privacy" target="_blank" rel="noopener noreferrer">Find it here</a>.
                    </p>
                </div>
            </div>
            <div class="modal-footer profile-modal-footer">
                <button class="btn btn-secondary" id="profileModalCancelBtn">Close</button>
                <button class="btn btn-primary" id="profileModalSaveBtn">Save Changes</button>
            </div>
        </div>
    </div>
        <header class="main-header">
        <div class="container header-container">
            <div class="header-left">
                <div class="logo">
                    <h1>RUSTY<span>DEGEN</span></h1>
                </div>
                <nav class="primary-nav">
                    <ul>
                        <li><a href="#" id="about-link">ABOUT</a></li>
                        <li><a href="#" id="tos-link">TOS</a></li>
                    </ul>
                </nav>
            </div>

            <nav class="main-nav header-center">
                <ul>
                    <li><a href="#" class="active jackpot-tab" id="home-link">JACKPOT</a></li>
                </ul>
            </nav>

            <div class="header-right">
                <nav class="secondary-nav">
                    <ul>
                        <li><a href="#" id="faq-link">FAQ</a></li>
                        <li><a href="#" id="fair-link">PROVABLY FAIR</a></li>
                    </ul>
                </nav>

                <div class="user-controls">
                    <button class="btn btn-primary" id="loginButton" style="display: flex;">
                        <i class="fa-brands fa-steam"></i>
                        <span>Sign in with Steam</span>
                    </button>

                    <div class="user-profile-container">
                        <span id="pending-offer-indicator" class="pending-offer-indicator" style="display: none;" title="You have a pending trade offer!">
                            <i class="fas fa-exclamation-circle"></i>
                        </span>
                        <div class="user-profile" id="userProfile" style="display: none;" role="button" aria-haspopup="true" aria-expanded="false" tabindex="0">
                            <div class="user-avatar-container">
                                <img src="/img/default-avatar.png" alt="User Avatar" class="user-avatar" id="userAvatar">
                                <div class="user-status online" id="userStatusIndicator"></div>
                            </div>
                            <span class="user-name" id="userName">PlayerName</span>
                            <i class="fas fa-chevron-down" style="margin-left: 5px; font-size: 0.8em; color: var(--text-secondary);"></i>
                        </div>

                        <div class="dropdown-menu" id="userDropdownMenu" style="display: none;" role="menu">
                            <div class="dropdown-actions">
                                <button class="dropdown-item" id="profileDropdownButton" role="menuitem">
                                    <i class="fas fa-user-circle icon"></i> Profile
                                </button>
                                <button class="dropdown-item" id="tradeHistoryButton" role="menuitem">
                                    <i class="fas fa-exchange-alt icon"></i> Trade History
                                </button>
                                <button class="dropdown-item" id="logoutButton" role="menuitem">
                                    <i class="fas fa-sign-out-alt icon"></i> Sign Out
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <section id="home-page">
                <div class="jackpot-section">
                    <div class="jackpot-header" id="jackpotHeader">
                        <div class="jackpot-value">
                            <h2 id="potValue">$0.00</h2>
                            <span class="value-label">CURRENT POT</span>
                        </div>
                        <div class="jackpot-timer">
                            <div class="timer-circle">
                                <svg class="timer-progress" viewBox="0 0 100 100">
                                    <circle class="timer-background" cx="50" cy="50" r="42"></circle>
                                    <circle class="timer-foreground" cx="50" cy="50" r="42"></circle>
                                </svg>
                                <div class="timer-text">
                                    <span id="timerValue">--</span>
                                </div>
                            </div>
                            <span class="timer-label">SECONDS LEFT</span>
                        </div>
                        <div class="jackpot-stats">
                            <span class="stat-value" id="participantCount">0/--</span>
                            <span class="stat-label">PARTICIPANTS</span>
                        </div>

                        <div class="inline-roulette" id="inlineRoulette" style="display: none;">
                            <div class="roulette-container">
                                <div class="roulette-track" id="rouletteTrack">
                                </div>
                                <div class="roulette-ticker">
                                    <div class="ticker-line"></div>
                                </div>
                            </div>
                            <div class="winner-info" id="winnerInfo" style="display: none;">
                                <div class="winner-header">
                                    <img src="/img/default-avatar.png" alt="Winner Avatar" class="winner-avatar" id="winnerAvatar">
                                    <h3 id="winnerName">WINNER NAME</h3>
                                </div>
                                <div class="winner-details">
                                    <p>Deposited: <span id="winnerDeposit">$0.00</span></p>
                                    <p>Chance: <span id="winnerChance">0.00%</span></p>
                                    <p class="congrats">Congratulations!</p>
                                </div>
                                <div class="confetti-container" id="confettiContainer"></div>
                            </div>
                            <audio id="spinSound" src="/audio/spin-sound.mp3" preload="auto"></audio>
                            <audio id="depositSound" src="/audio/deposit-join.mp3" preload="auto"></audio>
                            <button class="btn btn-primary return-btn" id="returnToJackpot" style="display: none;">Return</button>
                        </div>
                    </div>

                    <div class="deposit-button-container" id="depositBtnContainer">
                        <button class="btn btn-deposit" id="showDepositModal" title="Log in to deposit" disabled>DEPOSIT SKINS</button>
                        <div class="test-buttons-container" style="margin-top: 10px; display: none;">
                            <button class="btn btn-secondary btn-small" id="testSpinButton">Test Roulette</button>
                            <button class="btn btn-secondary btn-small" id="testDepositButton">Test Deposit</button>
                        </div>
                    </div>

                    <div class="current-items-section" id="currentItems">
                        <h3 class="section-title">CURRENT ITEMS IN POT</h3>
                        <div class="items-container" id="itemsContainer">
                            <div class="empty-pot-message" id="emptyPotMessage" style="display: block;">
                                <p>No items in the current pot. Be the first to deposit!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="about-page" style="display: none;">
                <div class="content-card">
                    <h1>About Rusty Degen</h1>
                    <div class="content-section">
                        <h3 class="content-section-title">The Developer Behind Rusty Degen</h3>
                        <div class="content-section-body">
                            <p>Hello! I'm a passionate Rust player with over 7,000 hours in the game. What started as a hobby quickly turned into an obsession, and I've experienced every aspect of the Rust ecosystem - from intense PvP battles to trading rare skins.</p>
                            <p>As a computer science student, I wanted to combine my two passions: programming and Rust. Rusty Degen is the result of this combination - a solo project developed from the ground up as part of my advanced computer science coursework.</p>
                            <p>Unlike many gambling platforms that are run by large teams with significant backing, Rusty Degen is entirely developed, maintained, and operated by a single person - me. This project has been an incredible learning experience, allowing me to apply theoretical knowledge to a real-world application while creating something for a community I deeply care about.</p>
                            <p>Please remember this is a project under development. Play responsibly and understand the risks involved.</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="tos-page" style="display: none;">
                <div class="content-card">
                    <h1>Terms of Service</h1>
                    <p><small>Last Updated: April 29, 2025</small></p>
                    <div class="content-section">
                        <h3 class="content-section-title">1. Acceptance of Terms</h3>
                        <div class="content-section-body">
                            <p>Welcome to Rusty Degen (referred to as "the Service" or "Website"). These Terms of Service ("Terms") outline the rules and regulations for using our platform. By accessing or utilizing any part of the Service, you signify your binding agreement to these Terms. If you disagree with any portion of these Terms, you are prohibited from using the Service.</p>
                            <p>Your use of the Website, participation in games, and any communication with Rusty Degen are all governed by these Terms.</p>
                        </div>
                    </div>
                    <!-- Additional TOS sections omitted for brevity -->
                </div>
            </section>

            <section id="faq-page" style="display: none;">
                <div class="content-card">
                    <h1>Frequently Asked Questions</h1>
                    <div class="content-section faq-item">
                        <h3 class="content-section-title">How does Rusty Degen work?</h3>
                        <div class="content-section-body" style="display: none;">
                            <p>Rusty Degen is a Rust skin jackpot site. Players deposit their Rust skins into a shared pot. Each skin adds value, and your chance to win is proportional to the value you deposit compared to the total pot value. When the round timer ends, our Provably Fair system randomly selects a winning ticket based on deposited value. The owner of that ticket wins all the items in the pot, minus a small site fee.</p>
                        </div>
                    </div>
                    <!-- Additional FAQ sections omitted for brevity -->
                </div>
            </section>

            <section id="fair-page" style="display: none;">
                <div class="content-card">
                    <h1>Provably Fair System</h1>
                    <div class="content-section">
                        <h3 class="content-section-title">How Our System Works</h3>
                        <div class="content-section-body">
                            <p>Rusty Degen uses a provably fair system to ensure complete transparency and fairness in winner selection. Our system uses cryptographic methods (specifically SHA256 hashing) to guarantee that the results cannot be manipulated by the site operators and can be independently verified by anyone after the round concludes.</p>
                        </div>
                    </div>
                    <div class="content-section">
                        <h3 class="content-section-title">The Process</h3>
                        <div class="content-section-body">
                            <ol>
                                <li><strong>Seed Generation:</strong> Before a round begins, the server generates a long, random, secret string called the "Server Seed".</li>
                                <li><strong>Hashing:</strong> The server calculates the SHA256 hash of this Server Seed. This hash (e.g., <code>a1b2c3d4...</code>) is publicly displayed for the round *before* any deposits are accepted. Hashing is a one-way process; you cannot get the original Seed from the Hash, but you can later verify that a revealed Seed produces the same Hash.</li>
                                <li><strong>Deposits & Tickets:</strong> Players deposit items. Each $0.01 of value deposited grants the player 1 ticket (or adjusted based on settings). Tickets are assigned ranges based on deposit order and value (e.g., Player A $1.00 gets tickets 0-99, Player B $2.50 gets tickets 100-349). The total number of tickets is the sum of tickets for all deposits.</li>
                                <li><strong>Round End & Client Seed:</strong> When the round ends (timer reaches zero or max items), a "Client Seed" is determined. This is typically derived from public round data making it unique and non-manipulable after the round closes (e.g., Round ID, end timestamp hash).</li>
                                <li><strong>Combined Hashing:</strong> The server combines the secret Server Seed and the public Client Seed (usually as <code>ServerSeedClientSeed</code> or <code>ServerSeed-ClientSeed</code> - check verification logic). It then calculates the SHA256 hash of this combined string.</li>
                                <li><strong>Winning Ticket Calculation:</strong> A deterministic calculation is performed on the final hash to get a number between 0 and 1. This number is multiplied by the total number of tickets to determine the winning ticket position. (e.g., <code>WinningPosition = floor(ResultingNumber * TotalTickets)</code>. The winning ticket is the one at this position (0-indexed).</li>
                                <li><strong>Winner Selection:</strong> The player whose assigned ticket range includes the calculated Winning Ticket position wins the pot.</li>
                                <li><strong>Seed Reveal:</strong> After the winner is determined and announced, the original secret Server Seed for that round is revealed publicly in the round history.</li>
                            </ol>
                        </div>
                    </div>
                    <div class="content-section" id="provably-fair-verification">
                        <h3 class="content-section-title">Verification Tool</h3>
                        <div class="content-section-body">
                            <p>After a round is complete and the Server Seed is revealed, you can use this tool (or any external SHA256 tool) to verify the outcome:</p>
                            <div class="verify-form">
                                <div class="form-panel">
                                    <div class="form-group">
                                        <label for="round-id">Round ID:</label>
                                        <input type="number" id="round-id" placeholder="Enter round ID from history" min="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="server-seed">Server Seed (Revealed):</label>
                                        <input type="text" id="server-seed" placeholder="Enter the revealed Server Seed (64 hex chars)">
                                    </div>
                                    <div class="form-group">
                                        <label for="client-seed">Client Seed:</label>
                                        <input type="text" id="client-seed" placeholder="Enter the Client Seed for the round">
                                    </div>
                                    <button class="btn btn-primary" id="verify-btn">Verify Round</button>
                                </div>
                                <div id="verification-result" class="result-panel" style="display: none;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="content-section">
                        <h3 class="content-section-title">Round History</h3>
                        <div class="content-section-body">
                            <div class="table-container">
                                <table class="history-table">
                                    <thead>
                                        <tr>
                                            <th>Round ID</th>
                                            <th>Date Ended</th>
                                            <th>Pot Value</th>
                                            <th>Winner</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rounds-table-body">
                                        <tr><td colspan="5" class="loading-message">Loading round history...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="pagination-container" id="rounds-pagination">
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy;2025 Rusty Degen. All rights reserved. Rusty Degen is not affiliated with Valve Corporation, Facepunch Studios, Rust or any other trademarks. Gambling can be addictive. Play responsibly. 18+</p>
            <p>
                <a href="#" id="tos-link-footer">Terms of Service</a> |
                <a href="#" id="fair-link-footer">Provably Fair</a> |
                <a href="#support" id="support-link" rel="noopener noreferrer">Support</a>
            </p>
        </div>
    </footer>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/main.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const faqItems = document.querySelectorAll('#faq-page .faq-item .content-section-title');
            faqItems.forEach(title => {
                title.addEventListener('click', () => {
                    const item = title.closest('.faq-item');
                    const body = item.querySelector('.content-section-body');
                    if (item && body) {
                        // Close other items
                        document.querySelectorAll('#faq-page .faq-item.active').forEach(openItem => {
                            if (openItem !== item) {
                                openItem.classList.remove('active');
                                const openBody = openItem.querySelector('.content-section-body');
                                if (openBody) openBody.style.display = 'none';
                            }
                        });
                        // Toggle current item
                        item.classList.toggle('active');
                        body.style.display = item.classList.contains('active') ? 'block' : 'none';
                    }
                });
            });

            // Footer/Modal Links Setup (Ensure main.js defines showPage and hideModal globally)
            const setupLink = (linkId, pageElementId) => {
                const link = document.getElementById(linkId);
                const page = document.getElementById(pageElementId);
                // Check if showPage is globally available
                if (link && page && typeof window.showPage === 'function') {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.showPage(page); // Assumes showPage handles hiding others & updating nav
                        // If it's the modal link, also close the modal it's in
                        const modal = link.closest('.modal');
                        if (modal && typeof window.hideModal === 'function') {
                            window.hideModal(modal);
                        }
                    });
                }
            };
            setupLink('tos-link-modal', 'tos-page');
            setupLink('tos-link-footer', 'tos-page');
            setupLink('fair-link-footer', 'fair-page');
        });
    </script>
</body>
</html>
